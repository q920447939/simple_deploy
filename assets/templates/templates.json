[
  {
    "id": "tpl_maven_package_skip_tests",
    "name": "Maven 打包（跳过测试）",
    "description": "mvn package -DskipTests，并复制产物到指定路径",
    "type": "local_script",
    "script": {
      "shell": "bash",
      "content": "set -euo pipefail\nPROJECT_DIR=\"${SD_project_dir:-/path/to/project}\"\nARTIFACT_GLOB=\"${SD_artifact_glob:-target/*.jar}\"\nOUTPUT_PATH=\"${SD_output_path:-/tmp/simple_deploy_artifacts/app.jar}\"\nMAVEN_CMD=\"${SD_maven_cmd:-mvn}\"\ncd \"$PROJECT_DIR\"\n$MAVEN_CMD -DskipTests package\nmkdir -p \"$(dirname \"$OUTPUT_PATH\")\"\nartifact=$(ls -1 $ARTIFACT_GLOB 2>/dev/null | head -n 1 || true)\nif [ -z \"$artifact\" ]; then\n  echo \"artifact not found: $ARTIFACT_GLOB\" >&2\n  exit 2\nfi\ncp \"$artifact\" \"$OUTPUT_PATH\"\necho \"artifact copied to $OUTPUT_PATH\"\n"
    },
    "file_slots": [],
    "variables": [
      {
        "name": "project_dir",
        "description": "项目根目录",
        "default": "/path/to/project",
        "required": true
      },
      {
        "name": "artifact_glob",
        "description": "产物匹配（相对 project_dir）",
        "default": "target/*.jar",
        "required": true
      },
      {
        "name": "output_path",
        "description": "产物复制路径（绝对路径）",
        "default": "/tmp/simple_deploy_artifacts/app.jar",
        "required": true
      },
      {
        "name": "maven_cmd",
        "description": "mvn 命令",
        "default": "mvn",
        "required": false
      }
    ],
    "outputs": [
      {"name": "artifact", "path": "${output_path}"}
    ]
  },
  {
    "id": "tpl_npm_build",
    "name": "NPM 打包（产物压缩）",
    "description": "npm run build，并将构建目录打包到指定路径",
    "type": "local_script",
    "script": {
      "shell": "bash",
      "content": "set -euo pipefail\nPROJECT_DIR=\"${SD_project_dir:-/path/to/project}\"\nBUILD_DIR=\"${SD_build_dir:-dist}\"\nOUTPUT_PATH=\"${SD_output_path:-/tmp/simple_deploy_artifacts/web_build.tar.gz}\"\ncd \"$PROJECT_DIR\"\nif [ -f package-lock.json ]; then\n  npm ci\nelse\n  npm install\nfi\nnpm run build\nmkdir -p \"$(dirname \"$OUTPUT_PATH\")\"\ntar -czf \"$OUTPUT_PATH\" -C \"$PROJECT_DIR\" \"$BUILD_DIR\"\necho \"artifact copied to $OUTPUT_PATH\"\n"
    },
    "file_slots": [],
    "variables": [
      {
        "name": "project_dir",
        "description": "项目根目录",
        "default": "/path/to/project",
        "required": true
      },
      {
        "name": "build_dir",
        "description": "构建输出目录（相对 project_dir）",
        "default": "dist",
        "required": true
      },
      {
        "name": "output_path",
        "description": "产物压缩包路径（绝对路径）",
        "default": "/tmp/simple_deploy_artifacts/web_build.tar.gz",
        "required": true
      }
    ],
    "outputs": [
      {"name": "artifact", "path": "${output_path}"}
    ]
  },
  {
    "id": "tpl_upload_file_keep",
    "name": "上传文件到目录（保持原名）",
    "description": "将文件传输到指定目录，目录不存在自动创建",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/upload_file_keep.yml",
    "playbook_name": "Upload File Keep Name",
    "playbook_description": "Upload file to target directory",
    "file_slots": [{"name": "file", "required": true, "multiple": false}],
    "variables": [
      {
        "name": "remote_dest_dir",
        "description": "目标目录",
        "default": "/opt/app",
        "required": true
      },
      {
        "name": "file_mode",
        "description": "文件权限",
        "default": "0644",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_upload_file_rename",
    "name": "上传文件到目录（指定文件名）",
    "description": "将文件传输到指定目录并重命名",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/upload_file_rename.yml",
    "playbook_name": "Upload File Rename",
    "playbook_description": "Upload file and rename",
    "file_slots": [{"name": "file", "required": true, "multiple": false}],
    "variables": [
      {
        "name": "remote_dest_dir",
        "description": "目标目录",
        "default": "/opt/app",
        "required": true
      },
      {
        "name": "dest_name",
        "description": "目标文件名",
        "default": "app.bin",
        "required": true
      },
      {
        "name": "file_mode",
        "description": "文件权限",
        "default": "0644",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_rename_file",
    "name": "文件重命名",
    "description": "将文件移动/重命名到新路径",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/rename_file.yml",
    "playbook_name": "Rename File",
    "playbook_description": "Rename file with mv",
    "file_slots": [],
    "variables": [
      {
        "name": "src_path",
        "description": "源路径",
        "default": "/opt/app/old.bin",
        "required": true
      },
      {
        "name": "dest_path",
        "description": "目标路径",
        "default": "/opt/app/new.bin",
        "required": true
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_kill_port",
    "name": "按端口 kill 进程",
    "description": "按端口号强制 kill（未找到也不失败）",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/kill_port.yml",
    "playbook_name": "Kill Port",
    "playbook_description": "Kill process by port",
    "file_slots": [],
    "variables": [
      {
        "name": "port",
        "description": "端口号",
        "default": "8080",
        "required": true
      },
      {
        "name": "signal",
        "description": "信号（默认 9）",
        "default": "9",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_start_program",
    "name": "启动程序",
    "description": "指定工作目录与启动命令，可选后台启动",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/start_program.yml",
    "playbook_name": "Start Program",
    "playbook_description": "Start program with command",
    "file_slots": [],
    "variables": [
      {
        "name": "work_dir",
        "description": "工作目录",
        "default": "/opt/app",
        "required": true
      },
      {
        "name": "start_cmd",
        "description": "启动命令",
        "default": "/opt/app/app",
        "required": true
      },
      {
        "name": "log_path",
        "description": "日志路径",
        "default": "/opt/app/app.log",
        "required": false
      },
      {
        "name": "detach",
        "description": "是否后台启动（true/false）",
        "default": "true",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_kill_port_start_java",
    "name": "Kill 端口后启动 Java",
    "description": "按端口强制 kill 后启动 Java 程序",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/kill_port_start_java.yml",
    "playbook_name": "Kill Port + Start Java",
    "playbook_description": "Kill port then start Java",
    "file_slots": [],
    "variables": [
      {
        "name": "port",
        "description": "端口号",
        "default": "8080",
        "required": true
      },
      {
        "name": "java_cmd",
        "description": "Java 启动命令",
        "default": "java -jar /opt/app/app.jar",
        "required": true
      },
      {
        "name": "work_dir",
        "description": "工作目录",
        "default": "/opt/app",
        "required": true
      },
      {
        "name": "log_path",
        "description": "日志路径",
        "default": "/opt/app/app.log",
        "required": false
      },
      {
        "name": "signal",
        "description": "信号（默认 9）",
        "default": "9",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_copy_extract",
    "name": "上传并解压",
    "description": "上传归档包并解压到目标目录",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/copy_extract.yml",
    "playbook_name": "Copy & Extract",
    "playbook_description": "Upload archive and extract to target directory",
    "file_slots": [{"name": "package", "required": true, "multiple": false}],
    "variables": [
      {
        "name": "remote_dest_dir",
        "description": "目标目录",
        "default": "/opt/app",
        "required": true
      },
      {
        "name": "archive_keep",
        "description": "是否保留原压缩包（true/false）",
        "default": "false",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_systemd_service",
    "name": "Systemd 服务控制",
    "description": "启动/停止/重启 systemd 服务",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/systemd_service.yml",
    "playbook_name": "Systemd Service",
    "playbook_description": "Manage systemd service state",
    "file_slots": [],
    "variables": [
      {
        "name": "service_name",
        "description": "服务名",
        "default": "my-service",
        "required": true
      },
      {
        "name": "service_state",
        "description": "状态：started/stopped/restarted",
        "default": "restarted",
        "required": false
      },
      {
        "name": "enabled",
        "description": "是否开机自启（true/false）",
        "default": "true",
        "required": false
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  },
  {
    "id": "tpl_java_jar_deploy",
    "name": "Java Jar 部署",
    "description": "上传 jar 并重启 systemd 服务",
    "type": "ansible_playbook",
    "playbook_path": "assets/templates/playbooks/java_jar_deploy.yml",
    "playbook_name": "Java Jar Deploy",
    "playbook_description": "Deploy jar and restart service",
    "file_slots": [{"name": "jar", "required": true, "multiple": false}],
    "variables": [
      {
        "name": "app_name",
        "description": "服务名",
        "default": "app",
        "required": true
      },
      {
        "name": "deploy_dir",
        "description": "部署目录",
        "default": "/opt/apps",
        "required": true
      },
      {
        "name": "python",
        "description": "远程 python 路径",
        "default": "/usr/bin/python3",
        "required": false
      }
    ],
    "outputs": []
  }
]
