# Simple Deploy（v1）使用说明

本工具用于小批量 Linux 服务器的 Ansible 标准化部署/升级：客户端本地管理配置，通过 SSH 将执行包下发到“控制端服务器”，由控制端直连被控端执行。

> 安全提示：v1 明文保存密码，仅适用于内网/单人/受控环境。

---

## 1. 控制端依赖（必须）
控制端是“已安装 Ansible 的 Linux 服务器”，并且可以 SSH 直连所有被控端。

必须具备：
- `ansible-playbook`
- `sshpass`（Ansible 密码登录通常依赖）
- `unzip`（解包依赖）

建议具备（可选）：
- `bash`
- `ssh`（系统自带）

在应用里可在“服务器 > 控制端 > 环境自检”直接检查上述依赖是否齐全。

---

## 2. 被控端依赖（必须）
- Linux
- Python >= 3.8

---

## 3. 首次配置步骤（最小闭环）
1) **项目**：创建一个项目（用于隔离服务器/Playbook/任务/批次/Run）。  
2) **服务器**：添加至少 1 个控制端 + 1 个被控端（root/密码）。  
3) **Playbook**：新建 Playbook，并在编辑器中编写后保存（保存会做 YAML 语法校验）。  
4) **任务**：创建任务并绑定 Playbook；如需上传文件，声明文件槽位（必选/可选、多文件/单文件）。  
5) **批次**：创建批次，选择 1 控制端、>=1 被控端、>=1 任务并排序。  
6) **执行**：在批次详情点“执行”，按任务/槽位选择本次要上传的文件（必选槽位未选无法开始）。  
7) **查看结果**：在批次详情中查看任务进度与日志；支持切换历史 Run 与任务日志。

---

## 4. 常见错误与处理
- **SSH 连接失败 / 超时 / 认证失败**：检查 IP/端口/用户名/密码、控制端是否允许密码登录、网络与防火墙策略。  
- **控制端自检失败（缺依赖）**：在控制端安装 `ansible-playbook` / `sshpass` / `unzip` 后重试。  
- **控制端 /tmp 不可写**：修复权限/磁盘空间，确保可创建 `/tmp/simple_deploy/`。  
- **解包失败**：确认控制端 `unzip` 可用，且当前用户对运行目录有权限。  
- **ansible-playbook exit!=0**：打开批次详情对应任务日志定位具体失败原因（inventory、权限、包路径、服务状态等）。  
- **批次“运行中”无法再次执行**：同一批次互斥；如异常退出导致锁残留，使用“强制解锁/重置”为异常恢复入口。  

